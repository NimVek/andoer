#!/usr/bin/env python

from nose.tools import *
from hdking import *
import io


def test_decoder():
    stream = io.BytesIO(bytearray(
        [0xab, 0xcd, 0x00, 0x48, 0x00, 0x00, 0x01, 0x15, 0x46, 0x33, 0x4a,
         0x39, 0x41, 0x39, 0x4e, 0x45, 0x34, 0x45, 0x36, 0x52, 0x55, 0x48,
         0x36, 0x50, 0x53, 0x46, 0x5a, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00]))

    connection = HDKingStatelessConnection(stream)
    packet = connection.receive()
    assert_equal(type(packet), HDKingPacketFindDeviceResponse)
    assert_equal(packet.uid, 'F3J9A9NE4E6RUH6PSFZ1')
